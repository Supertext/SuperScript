<!DOCTYPE html>
<html>

    <head>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-overrides.css" rel="stylesheet">
        <link href="css/shCore.css" rel="stylesheet">
        <link href="css/shCoreDefault.css" rel="stylesheet">
        <link href="css/shThemeDefault.css" rel="stylesheet">
        <link rel="icon" href="img/favicon.ico">
        <title>SuperScript Documentation - The Emitter</title>
    </head>

<body>

    <header class="navbar navbar-static-top bs-docs-nav">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                    <img alt="Brand" src="img/superscript-logo.gif">
                </a>
            </div>
            <nav class="collapse navbar-collapse bs-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="current-projects.html">Current Projects</a></li>
                    <li><a href="core-concepts.html">Core Concepts</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://github.com/Supertext/SuperScript">View on GitHub</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div id="content">

        <div class="jumbotron">
            <div class="container">
                <h1>SuperScript</h1>
            </div>
        </div>

        <div class="container">

            <div class="row">

                <div class="col-xs-12">

                    <p>
                        <mark><strong><em>This documentation is still being written. Please bear with us while we complete this documentation.</em></strong></mark>
                    </p>

                    <h2>The Emitter</h2>

                    <p>
                        Along with <em>declarables</em>, emitters are a core concept of SuperScript.
                    </p>

                    <h3>What is an Emitter?</h3>

                    <p>
                        An <em>emitter</em> is an instance of <attr title="SuperScript.Emitters.IEmitter"><code>IEmitter</code></attr>.
                    </p>

                    <pre class="brush: c#">
                        public interface SuperScript.Emitters.IEmitter
                        {
                            object CustomObject { get; set; }
                            bool IsDefault { get; set; }
                            string Key { get; set; }
                            IHtmlString ToHtmlString(IEnumerable&lt;DeclarationBase&gt; declarations);
                            CollectionConverter Converter { get; set; }
                            ICollection&lt;CollectionPreModifier&gt; PreModifiers { get; set; }
                            ICollection&lt;CollectionPostModifier&gt; PostModifiers { get; set; }
                            HtmlWriter HtmlWriter { get; set; }
                        }
                    </pre>

                    <p>
                        As described in <a href="core-concepts.html">Core Concepts</a>, an emitter can be thought of as a pipeline which
                        deals with the converting of <attr title="SuperScript.Common.Declarables.DeclarationBase"><code>DeclarationBase</code></attr>
                        instances into their client-side form.
                    </p>

                    <p>
                        Let's take a look at each of the members on the <attr title="SuperScript.Emitters.IEmitter"><code>IEmitter</code></attr> interface.
                    </p>

                    <ul>
                        <li>
                            <h4><code>object CustomObject</code></h4>
                            <p>
                                This property allows the user to pass any required object through the modification and conversion process.
                            </p>
                        </li>
                        <li>
                            <h4><code>bool IsDefault</code></h4>
                            <p>
                                Each declaration should have details of the emitter which should process and render its client-side form. This should be specified
                                on the declaration's <attr title="SuperScript.Declarables.DeclarationBase.EmitterKey"><code>EmitterKey</code></attr> property.
                            </p>
                            <p>
                                However, by not specifying a value for <attr title="SuperScript.Declarables.DeclarationBase.EmitterKey"><code>EmitterKey</code></attr>
                                SuperScript will automatically provide the key for the default emitter.
                            </p>
                            <p>
                                The default emitter is the <em>first</em> emitter in the collection with <attr title="SuperScript.Emitters.IEmitter.IsDefault"><code>IsDefault</code></attr>
                                set to <code>true</code>; if none have this value explicitly set then the default emitter is the first emitter in the
                                <attr title="SuperScript.Declarations.Emitters"><code>Emitters</code></attr> collection.
                            </p>
                            <p>
                                <strong>Important:</strong> to allow SuperScript to fall back on the key of the default emitter (which is not the case when a key is
                                explicitly specified) the emitters <u>must</u> have been specified prior to the declaration being added to the collection.
                            </p>
                        </li>
                        <li>
                            <h4><code>string Key</code></h4>
                            <p>
                                This is the value by which an emitter is identified by declarations, and when an emitter is requested to emit its
                                declared contents (<em>the client-side form of all declarations specifying this emitter</em>).
                            </p>
                        </li>
                        <li>
                            <h4><code>IHtmlString ToHtmlString(IEnumerable&lt;DeclarationBase&gt; declarations);</code></h4>
                            <p>
                                When called, this method emits the client-side form of the specified declarations.
                            </p>
                        </li>
                        <li>
                            <h4><code>CollectionConverter Converter { get; set; }</code></h4>
                            <p>
                                The implementation of <attr title="SuperScript.Modifiers.Converters.CollectionConverter"><code>CollectionConverter</code></attr> which has been assigned to this emitter.
                            </p>
                            <p>
                                A <attr title="SuperScript.Modifiers.Converters.CollectionConverter"><code>CollectionConverter</code></attr> is <strong>not required</strong>
                                for an emitter.
                            </p>
                        </li>
                        <li>
                            <h4><code>ICollection&lt;CollectionPreModifier&gt; PreModifiers { get; set; }</code></h4>
                            <p>
                                The implementations of <attr title="SuperScript.Modifiers.Converters.CollectionPreModifier"><code>CollectionPreModifier</code></attr>
                                which have been assigned to this emitter.
                            </p>
                            <p>
                                A <attr title="SuperScript.Modifiers.Converters.CollectionPreModifier"><code>CollectionPreModifier</code></attr> is <strong>not required</strong>
                                for an emitter.
                            </p>
                        </li>
                        <li>
                            <h4><code>ICollection&lt;CollectionPostModifier&gt; PostModifiers { get; set; }</code></h4>
                            <p>
                                The implementations of <attr title="SuperScript.Modifiers.Pre.CollectionPostModifier"><code>CollectionPostModifier</code></attr>
                                which have been assigned to this emitter.
                            </p>
                            <p>
                                A <attr title="SuperScript.Modifiers.Pre.CollectionPostModifier"><code>CollectionPostModifier</code></attr> is <strong>not required</strong>
                                for an emitter.
                            </p>
                        </li>
                        <li>
                            <h4><code>HtmlWriter HtmlWriter { get; set; }</code></h4>
                            <p>
                                The implementation of <attr title="SuperScript.Modifiers.Writers.HtmlWriter"><code>HtmlWriter</code></attr>
                                which has been assigned to this emitter.
                            </p>
                            <p>
                                A <attr title="SuperScript.Modifiers.Writers.HtmlWriter"><code>HtmlWriter</code></attr> <strong>is required</strong>
                                for an emitter.
                            </p>
                        </li>
                    </ul>


                    <h3 id="create-emitter">Creating an Emitter</h3>

                    <p>
                        One of the first thing you'll want to do with SuperScript is create the emitter or emitters. There are two ways of achieving this:
                    </p>
                    
                    <ol>
                        <li><a href="#configure-emitter">specifying an emitter in the configuration file</a></li>
                        <li><a href="#emitter-programmatically">specifying an emitter programmatically</a></li>
                    </ol>


                    <h4 id="configure-emitter">Specifying an emitter in the configuration file</h4>

                    <p>
                        SuperScript allows many of its features to be declared in the configuration file.
                    </p>

                    <pre class="brush: xml">
                        &lt;configSections&gt;
                            &lt;section name="superScript" type="SuperScript.Configuration.SuperScriptConfig, SuperScript.Common, Version=0.0.0.1, Culture=neutral" /&gt;
                        &lt;/configSections&gt;
                        &#10;
                        &hellip;
                        &#10;
                        &lt;superScript&gt;
                            &lt;emitters&gt;
                                &lt;emitter key="javascript" isDefault="true"&gt;
                                    &lt;converters&gt;
                                        &lt;modifier type="SuperScript.JavaScript.Modifiers.Converters.JavaScriptStringify, SuperScript.JavaScript" /&gt;
				                    &lt;/converters&gt;
                                    &lt;postModifiers&gt;
                                        &lt;modifier emitMode="LiveOnly" type="SuperScript.JavaScript.Modifiers.Post.JavaScriptMinifier, SuperScript.JavaScript" /&gt;
				                    &lt;/postModifiers&gt;
                                    &lt;writers&gt;
                                        &lt;modifier type="SuperScript.ExternalFile.Modifiers.Writers.ExternalScriptWriter, SuperScript.ExternalFile" /&gt;
				                    &lt;/writers&gt;
			                    &lt;/emitter&gt;                        
                            &lt;/emitters&gt;
                        &lt;/superScript&gt;
                    </pre>

                    <p class="small">
                        The above example requires the <a href="https://github.com/Supertext/SuperScript.Common" target="_blank">SuperScript.Common</a> as well as additional libraries.
                    </p>
                    
                    <p>
                        Here is a description of the above example:
                    </p>
                    
                    <ol>
                        <li>
                            The configuration's <code>&lt;configSections&gt;</code> element is modified to allow a custom section (<code>&lt;superScript&gt;</code>), hitherto unrecognised by ASP.NET,
                            to be declared.
                        </li>
                        <li>
                            <p>
                                An emitter is instantiated and added to the <attr title="SuperScript.Declarations.Emitters"><code>Emitters</code></attr> collection.
                            </p>
                            <p>
                                This instance of <attr title="SuperScript.Emitters.IEmitter"><code>IEmitter</code></attr> is actually an object of type 
                                <attr title="SuperScript.Emitters.StandardEmitter"><code>StandardEmitter</code></attr>, which is the default type (if not specified).
                            </p>
                            <p>
                                Of course, it is possible to derive custom implementations of <attr title="SuperScript.Emitters.IEmitter"><code>IEmitter</code></attr>
                                with more features, and then specify the type in the <code>type</code> attribute on the <code>&lt;emitter&gt;</code> element.
                            </p>
                        </li>
                        <li>
                            <p>
                                The value "javascript" is assigned as the <attr title="SuperScript.Emitters.IEmitter.Key"><code>Key</code></attr> for this emitter
                            </p>
                        </li>
                        <li>
                            <p>
                                An instance of <attr title="SuperScript.JavaScript.Modifiers.Converters.JavaScriptStringify"><code>JavaScriptStringify</code></attr> is then assigned to the
                                <attr title="SuperScript.Emitters.IEmitter.CollectionConverter"><code>CollectionConverter</code></attr> property.
                            </p>
                            <p>
                                This specific implementation of <attr title="SuperScript.Modifiers.Converters.CollectionConverter"><code>CollectionConverter</code></attr>
                                has not been covered yet, but it should suffice to say that this is simply an implementation which runs on
                                the JavaScript-oriented declarables found in the <a href="https://github.com/Supertext/SuperScript.JavaScript" target="_blank">SuperScript.JavaScript</a> project.
                            </p>
                        </li>
                        <li>
                            <p>
                                An instance of <attr title="SuperScript.JavaScript.Modifiers.Post.JavaScriptMinifier"><code>JavaScriptMinifier</code></attr> is
                                then assigned to the <attr title="SuperScript.Emitters.IEmitter.PostModifiers"><code>PostModifiers</code></attr> property.
                            </p>
                            <p>
                                This specific type of <attr title="SuperScript.Modifiers.Post.CollectionPostModifier"><code>CollectionPostModifier</code></attr>
                                has not been covered yet, but it should suffice to say that this is simply an implementation which uses Microsoft's
                                <a href="https://webgrease.codeplex.com/" target="_blank">WebGrease</a> library to minify javascript.
                            </p>
                            <p>
                                Note that this <code>modifier</code> element has its <code>emitMode</code> attribute set to
                                <attr title="SuperScript.EmitMode.LiveOnly"><code>LiveOnly</code></attr>. This will be covered when discussing modifiers.
                            </p>
                        </li>
                        <li>
                            <p>
                                An instance of <attr title="SuperScript.ExternalFile.Modifiers.Writers.ExternalScriptWriter"><code>ExternalScriptWriter</code></attr>
                                is assigned to the <attr title="SuperScript.Emitters.IEmitter.HtmlWriter"><code>HtmlWriter</code></attr> property.
                            </p>
                            <p>
                                Again, this implementation of <code>HtmlWriter</code> is documented elsewhere, but this class writes the client-side form of
                                the emitter's declarations to an external file and places a <code>&lt;script src="&hellip;"&gt;</code> tag on the page.
                            </p>
                        </li>
                    </ol>
                    
                    <p>
                        This emitter may now be referenced in declarations' <code>EmitterKey</code> property. However, because this emitter was also declared with
                        as the default emitter, any declarations which are added to <attr title="SuperScript.Declarations.Collection"><code>SuperScript.Declarations.Collection</code></attr>
                        <em>without</em> an emitter key being stated will automatically be emitted using this (default) emitter.
                    </p>


                    <h4 id="emitter-programmatically">Specifying an emitter programmatically</h4>

                    <p>
                        An alternative to using the configuration file is to call some code which instantiates an emitter and adds it to the
                        <attr title="SuperScript.Declarations.Emitters"><code>Emitters</code></attr> collection.
                    </p>

                    <pre class="brush: c#">
                        SuperScript.Configuration.Settings.Instance.Emitters.Add(new StandardEmitter
		                                                                             {
			                                                                            Converter = new JavaScriptStringify(),
			                                                                            Key = "whenReady",
			                                                                            PostModifiers = new Collection&lt;CollectionPostModifier&gt;
				                                                                                            {
					                                                                                            new WhenReady
						                                                                                            {
							                                                                                            UseWhenBundled = true
						                                                                                            },
					                                                                                            new JavaScriptMinifier
						                                                                                            {
							                                                                                            EmitMode = EmitMode.LiveOnly,
							                                                                                            UseWhenBundled = false
						                                                                                            }
				                                                                                            },
			                                                                            HtmlWriter = new ScriptTagWriter()
		                                                                             });
                    </pre>

                    <p>
                        When specifying emitters programatically, this code should be placed in a method which is called once per application. For example, 
                        the <em>global.asax</em>'s <code>Application_Start</code> method presents a good opportunity.
                    </p>



                    <h3 id="pass-declarations-emitter">Passing Declarations to an Emitter</h3>

                    <p>
                        We now know that an application using SuperScript has an application-wide collection of declarations, and that these are then passed to
                        emitters which process and modify the declarations before writing a desired output to the webpage.
                    </p>

                    <p>
                        One thing which has yet to be explained is how and which emitter the declarations are passed through.
                    </p>

                    <h4 id="multiple-emitters">Multiple Emitters</h4>

                    <p>
                        An application may have multiple emitters, each with a different set of <em>modifiers</em>, and each with a different
                        <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr>. The <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr>
                        is essentially a name for the emitter. Each emitter must therefore have a unique <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr>.
                    </p>

                    <p>
                        And when a declaration is created, an emitter's key is specified.
                    </p>

                    <h4 id="how-to-emit">How to Emit</h4>

                    <p>
                        In the desired, optimal location for writing the output of an emitter, there are three possible methods for writing the output.
                    </p>

                    <ul>
                        <li>
                            <h4>Output a specific declaration</h4>
                            <p>
                                By specifying the <em>Name</em> property of a declaration.
                            </p>
                            <pre class="brush: c#; html-script: true">
                                [WebForms]
                                <%: SuperScript.Declarations.Emit("myVar") %>
                            </pre>
                            <pre class="brush: razor">
                                [Razor view]
                                @SuperScript.Declarations.Emit("myVar")
                            </pre>
                            <p class="small">
                                The above examples assume that a declaration with the <em>Name</em> "myVar" has been added to <code>Superscript.Declarations</code>.
                            </p>
                            <p>
                                Calling <code>Emit</code> instructs SuperScript to pull the specified instance of <attr title="SuperScript.Common.Declarables.DeclarationBase"><code>DeclarationBase</code></attr>,
                                determine which emitter should process it, and the passes the instance to that emitter.
                            </p>
                        </li>
                        <li>
                            <h4>Output all declarations for a specific emitter</h4>
                            <p>
                                By specifying the <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr> of an emitter.
                            </p>
                            <pre class="brush: c#; html-script: true">
                                [WebForms]
                                <%: SuperScript.Declarations.EmitFor("javascript") %>
                            </pre>
                            <pre class="brush: razor">
                                [Razor view]
                                @SuperScript.Declarations.EmitFor("javascript")
                            </pre>
                            <p class="small">
                                The above examples assume that an emitter has been declared with the <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr> "javascript".
                            </p>
                            <p>
                                Calling <code>EmitFor</code> instructs SuperScript to retrieve all instances of <attr title="SuperScript.Common.Declarables.DeclarationBase"><code>DeclarationBase</code></attr>
                                which reference the specified emitter <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr>, then pass this collection of
                                <attr title="SuperScript.Common.Declarables.DeclarationBase"><code>DeclarationBase</code></attr> objects to that emitter.
                            </p>
                        </li>
                        <li>
                            <h4>Output for all emitters</h4>
                            <p>
                                By calling <code>EmitForAll</code> the output of all configured emitters can be written in the same location.
                            </p>
                            <pre class="brush: c#; html-script: true">
                                <%: SuperScript.Declarations.EmitForAll() %>
                            </pre>
                            <pre class="brush: razor">
                                @SuperScript.Declarations.EmitForAll()
                            </pre>
                            <p>
                                Calling <code>EmitForAll</code> instructs SuperScript to group all instances of <attr title="SuperScript.Common.Declarables.DeclarationBase"><code>DeclarationBase</code></attr>
                                by their <attr title="SuperScript.Emitters.IEmitter.Key"><code>key</code></attr> properties, then pass each group to that group's emitter.
                            </p>
                        </li>
                    </ul>

                </div>

            </div>

        </div>

    </div>

    <footer>
        <div class="container">
            <p class="text-muted">
                SuperScript is made available under the <a href="https://github.com/Supertext/SuperScript/blob/gh-pages/LICENSE" target="_blank">MIT license</a>
            </p>
            <p>
                <a href="https://github.com/Supertext/SuperScript">View on GitHub</a>
            </p>
            <p>
                <a href="index.html"><img alt="Brand" src="img/superscript-logo.gif"></a>
            </p>
        </div>
    </footer>

    <script src="scripts/shCore.js" type="text/javascript"></script>
    <script src="scripts/shBrushCSharp.js" type="text/javascript"></script>
    <script src="scripts/shBrushXml.js" type="text/javascript"></script>
    <script src="scripts/shBrushJScript.js" type="text/javascript"></script>
    <script src="scripts/shBrushRazor.js" type="text/javascript"></script>
    <script type="text/javascript">
        SyntaxHighlighter.defaults["gutter"] = false;
        SyntaxHighlighter.defaults["toolbar"] = false;
        SyntaxHighlighter.all();
    </script>

</body>



</html>